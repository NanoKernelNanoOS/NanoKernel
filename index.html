<script>
    // Инициализация Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCu5jtb_u7H13Fl0OzGjp68jrBoUwIhfgI",
        authDomain: "nano-e1f63.firebaseapp.com",
        databaseURL: "https://nano-e1f63-default-rtdb.firebaseio.com",
        projectId: "nano-e1f63",
        storageBucket: "nano-e1f63.firebasestorage.app",
        messagingSenderId: "904182892074",
        appId: "1:904182892074:web:baed54b3dc97b1e7c16553"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Показываем выбранный раздел
    function showSection(sectionId) {
        // Скрываем все разделы
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active-section');
        });

        // Показываем выбранный раздел
        document.getElementById(sectionId).classList.add('active-section');
    }

    // Отслеживание загрузок
    function trackDownload(version) {
        const ref = database.ref('downloadCounts/' + version);
        ref.transaction(currentCount => {
            return (currentCount || 0) + 1;
        });

        // Разрешаем переход по ссылке
        return true;
    }

    // Загрузка счетчиков
    function loadDownloadCounts() {
        // Создаем массив с ID версий, соответствующих элементам на странице
        const versions = [
            {id: 'ver1', countElement: 'count1'}, // 0.0.3
            {id: 'ver2', countElement: 'count2'}, // 0.0.2
            {id: 'ver3', countElement: 'count3'}, // 0.0.1bt
            {id: 'ver4', countElement: 'count4'}  // 25062025
        ];

        versions.forEach(item => {
            database.ref('downloadCounts/' + item.id).on('value', snapshot => {
                const count = snapshot.val() || 0;
                document.getElementById(item.countElement).textContent = `${count} downloads`;
            });
        });
    }

    // Notification functionality
    function setupNotifications() {
        const toggle = document.getElementById('notificationToggle');
        
        // Check if notifications are supported
        if (!('Notification' in window)) {
            toggle.disabled = true;
            console.log('This browser does not support notifications');
            return;
        }
        
        // Check current permission state
        if (Notification.permission === 'denied') {
            toggle.disabled = true;
            console.log('Notifications are blocked by the user');
            return;
        }
        
        // Load saved preference
        const notificationsEnabled = localStorage.getItem('notificationsEnabled') === 'true';
        toggle.checked = notificationsEnabled;
        
        // Set up toggle handler
        toggle.addEventListener('change', function() {
            if (this.checked) {
                // Request permission if not already granted
                if (Notification.permission !== 'granted') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            localStorage.setItem('notificationsEnabled', 'true');
                            showSampleNotification();
                        } else {
                            this.checked = false;
                        }
                    });
                } else {
                    localStorage.setItem('notificationsEnabled', 'true');
                    showSampleNotification();
                }
            } else {
                localStorage.setItem('notificationsEnabled', 'false');
            }
        });
        
        // If notifications are enabled, listen for news updates
        if (notificationsEnabled) {
            listenForNewsUpdates();
        }
    }
    
    function showSampleNotification() {
        if (Notification.permission === 'granted') {
            new Notification('Nano OS News', {
                body: 'Notifications are now enabled! You will receive updates about new releases and important news.',
                icon: 'https://via.placeholder.com/64'
            });
        }
    }
    
    function listenForNewsUpdates() {
        // In a real implementation, you would listen to Firebase for news updates
        // For now, we'll just simulate it with a timeout
        setTimeout(() => {
            if (localStorage.getItem('notificationsEnabled') === 'true' && Notification.permission === 'granted') {
                new Notification('New Nano OS Update', {
                    body: 'Version 0.0.3 is now available for download!',
                    icon: 'https://via.placeholder.com/64'
                });
            }
        }, 10000);
    }

    // Initialize everything when the page loads
    window.onload = function() {
        loadDownloadCounts();
        setupNotifications();
    };
</script>
